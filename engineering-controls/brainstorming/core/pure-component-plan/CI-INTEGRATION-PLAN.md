# Pure Component CIÈõÜÊàêÂÆûÊñΩËÆ°Âàí

## 1. Ê¶ÇËø∞

Êú¨ÊñáÊ°£ÊèèËø∞Â¶Ç‰ΩïÂ∞ÜPure ComponentÊ£ÄÊµãÈõÜÊàêÂà∞Áé∞ÊúâÁöÑCI/CDÊµÅÁ®ã‰∏≠ÔºåÈááÁî®GitHub Actions‰Ωú‰∏∫‰∏ªË¶ÅÂÆûÊñΩÊñπÊ°àÔºåÂÆûÁé∞Èõ∂‰æµÂÖ•ÊÄßÁöÑËá™Âä®ÂåñË¥®ÈáèÊ£ÄÊµã„ÄÇ

## 2. Ê†∏ÂøÉÂéüÂàô

- **Èõ∂‰æµÂÖ•ÊÄß**Ôºö‰∏ç‰øÆÊîπÁé∞ÊúâCIÈÖçÁΩÆÔºåÈÄöËøáÊñ∞Â¢ûÁã¨Á´ãworkflowÂÆûÁé∞
- **Ê∏êËøõÂºèÊé®Ëøõ**Ôºö‰ªéÈÄöÁü•ÂºÄÂßãÔºåÈÄêÊ≠•ÊèêÂçáÂà∞ÈòªÂ°û
- **ÂºÄÂèëÂèãÂ•Ω**ÔºöÊèê‰æõÊ∏ÖÊô∞ÁöÑÊä•ÂëäÂíå‰øÆÂ§çÊåáÂØº
- **ÊÄßËÉΩ‰ºòÂÖà**Ôºö‰∏çÊòæËëóÂ¢ûÂä†CIÊó∂Èó¥

## 3. ÂÆûÊñΩÈò∂ÊÆµ

### Phase 0: ÂáÜÂ§áÂ∑•‰ΩúÔºàÁ¨¨1Âë®Ôºâ

#### 3.1 Á°ÆÂÆöÊ£ÄÊµãËåÉÂõ¥
```yaml
# ÈúÄË¶ÅÊ£ÄÊµãÁöÑÁªÑ‰ª∂ÁõÆÂΩï
component_paths:
  - src/common/components/**/*.{jsx,tsx}
  - src/features/**/components/**/*.{jsx,tsx}
  
# ÊéíÈô§ÁöÑÊñá‰ª∂
exclude:
  - **/*.test.{jsx,tsx}
  - **/*.stories.{jsx,tsx}
  - **/demo/**
```

#### 3.2 Âª∫Á´ãÂü∫ÂáÜ
```bash
# Âú®master/developÂàÜÊîØÂª∫Á´ãÁªÑ‰ª∂Âü∫ÂáÜ
npm run pct:baseline -- \
  --branch develop \
  --output ./pct-baseline \
  --components src/common/components
```

### Phase 1: ÈÄöÁü•Ê®°ÂºèÔºàÁ¨¨2-3Âë®Ôºâ

#### 3.1 ÂàõÂª∫GitHub Actions Workflow

```yaml
# .github/workflows/pure-component-check.yml
name: Pure Component Check

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - 'src/**/components/**/*.jsx'
      - 'src/**/components/**/*.tsx'
      - 'src/**/components/**/*.scss'
      - 'src/**/components/**/*.css'

jobs:
  component-analysis:
    name: Analyze Components
    runs-on: ubuntu-latest
    # ÂàùÊúüËÆæÁΩÆ‰∏∫ÈùûÈòªÂ°û
    continue-on-error: true
    
    steps:
      - name: Checkout PR Branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup Environment
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install PCT Tool
        run: |
          # ‰ªéMDTÈ°πÁõÆÂÆâË£ÖPCTÂ∑•ÂÖ∑
          npm install -g @mdt/pct-cli
          # ÊàñËÄÖ‰ΩøÁî®npxÁõ¥Êé•ËøêË°å
          
      - name: Detect Changed Components
        id: detect
        run: |
          # Ëé∑ÂèñÂèòÊõ¥ÁöÑÁªÑ‰ª∂ÂàóË°®
          CHANGED_COMPONENTS=$(pct detect \
            --base origin/${{ github.base_ref }} \
            --head ${{ github.sha }} \
            --format json)
            
          echo "components=$CHANGED_COMPONENTS" >> $GITHUB_OUTPUT
          
      - name: Run Component Analysis
        id: analyze
        run: |
          pct analyze \
            --base origin/${{ github.base_ref }} \
            --head ${{ github.sha }} \
            --components '${{ steps.detect.outputs.components }}' \
            --output ./pct-report
            
          # ËÆæÁΩÆËæìÂá∫ÂèòÈáè
          if [ -f "./pct-report/has-breaking-changes" ]; then
            echo "has_breaking_changes=true" >> $GITHUB_OUTPUT
          else
            echo "has_breaking_changes=false" >> $GITHUB_OUTPUT
          fi
          
      - name: Generate Visual Report
        if: steps.analyze.outputs.has_breaking_changes == 'true'
        run: |
          pct report \
            --input ./pct-report \
            --format html \
            --output ./pct-report/visual-report.html
            
      - name: Upload Reports
        uses: actions/upload-artifact@v4
        with:
          name: pct-analysis-report
          path: |
            pct-report/
            
      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const reportPath = './pct-report/summary.json';
            
            if (!fs.existsSync(reportPath)) {
              console.log('No component changes detected');
              return;
            }
            
            const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));
            
            let comment = '## üîç Pure Component Analysis Report\n\n';
            comment += `**Branch:** \`${{ github.head_ref }}\` ‚Üí \`${{ github.base_ref }}\`\n`;
            comment += `**Analyzed at:** ${new Date().toISOString()}\n\n`;
            
            // ÂèòÊõ¥ÊëòË¶Å
            comment += '### üìä Summary\n\n';
            comment += `- Total components analyzed: ${report.totalComponents}\n`;
            comment += `- Components with changes: ${report.changedComponents}\n`;
            comment += `- Breaking changes: ${report.breakingChanges.length}\n`;
            comment += `- New components: ${report.newComponents.length}\n\n`;
            
            // Á†¥ÂùèÊÄßÂèòÊõ¥
            if (report.breakingChanges.length > 0) {
              comment += '### ‚ö†Ô∏è Breaking Changes\n\n';
              comment += '> The following components have breaking changes that may affect existing usage:\n\n';
              
              report.breakingChanges.forEach(change => {
                comment += `#### üî∏ \`${change.component}\`\n`;
                comment += `- **Change Type:** ${change.type}\n`;
                comment += `- **Description:** ${change.description}\n`;
                comment += `- **Affected Props:** ${change.affectedProps.join(', ')}\n`;
                comment += `- **Visual Diff:** [View Comparison](${change.visualDiffUrl})\n\n`;
                
                // ÊòæÁ§∫ÂÖ∑‰Ωì‰æãÂ≠ê
                if (change.examples && change.examples.length > 0) {
                  comment += '<details>\n';
                  comment += '<summary>Examples of affected usage</summary>\n\n';
                  comment += '```jsx\n';
                  comment += change.examples[0].code;
                  comment += '\n```\n';
                  comment += '</details>\n\n';
                }
              });
              
              comment += '> üí° **To approve these changes:** Add `[pct-approved]` to your PR description\n\n';
            }
            
            // Êñ∞ÁªÑ‰ª∂
            if (report.newComponents.length > 0) {
              comment += '### ‚ú® New Components\n\n';
              report.newComponents.forEach(comp => {
                comment += `- \`${comp.name}\` (${comp.path})\n`;
              });
              comment += '\n> üìù Remember to add tests for new components\n\n';
            }
            
            // Êä•ÂëäÈìæÊé•
            comment += '### üìã Full Report\n\n';
            comment += `üîó [View Detailed Analysis](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})\n`;
            
            // Êü•ÊâæÂπ∂Êõ¥Êñ∞Áé∞ÊúâËØÑËÆ∫
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            
            const botComment = comments.find(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('Pure Component Analysis Report')
            );
            
            if (botComment) {
              await github.rest.issues.updateComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: botComment.id,
                body: comment
              });
            } else {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: comment
              });
            }
```

#### 3.2 ÈÖçÁΩÆÈÄöÁü•Á∫ßÂà´

```yaml
# .github/pct-config.yml
notification:
  # Phase 1: Âè™ÈÄöÁü•‰∏çÈòªÂ°û
  mode: "notify-only"
  
  # ÈÄöÁü•ËßÑÂàô
  rules:
    - component: "src/common/components/Button/**"
      level: "warning"
      notify: ["@frontend-team"]
      
    - component: "src/common/components/**"
      level: "info"
      
    - component: "src/features/**/components/**"
      level: "info"
```

### Phase 2: ÂèØÈÄâÈòªÂ°ûÊ®°ÂºèÔºàÁ¨¨4-5Âë®Ôºâ

#### Êõ¥Êñ∞workflowÊîØÊåÅÈòªÂ°û

```yaml
      - name: Evaluate Blocking Rules
        id: evaluate
        run: |
          # ËØªÂèñÈÖçÁΩÆ
          CONFIG=$(cat .github/pct-config.yml)
          MODE=$(echo "$CONFIG" | yq '.notification.mode')
          
          # Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•ÈòªÂ°û
          if [[ "$MODE" == "blocking-with-approval" ]] && \
             [[ "${{ steps.analyze.outputs.has_breaking_changes }}" == "true" ]]; then
            
            # Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊâπÂáÜ
            if [[ "${{ github.event.pull_request.body }}" == *"[pct-approved]"* ]]; then
              echo "Changes approved"
              echo "should_block=false" >> $GITHUB_OUTPUT
            else
              echo "Breaking changes need approval"
              echo "should_block=true" >> $GITHUB_OUTPUT
            fi
          else
            echo "should_block=false" >> $GITHUB_OUTPUT
          fi
          
      - name: Set Check Status
        uses: actions/github-script@v7
        with:
          script: |
            const shouldBlock = '${{ steps.evaluate.outputs.should_block }}' === 'true';
            const hasBreakingChanges = '${{ steps.analyze.outputs.has_breaking_changes }}' === 'true';
            
            let conclusion = 'success';
            let title = '‚úÖ Component Check Passed';
            let summary = 'No breaking changes detected.';
            
            if (shouldBlock) {
              conclusion = 'failure';
              title = '‚ùå Component Check Failed';
              summary = 'Breaking changes detected and need approval. Add [pct-approved] to PR description.';
            } else if (hasBreakingChanges) {
              conclusion = 'success';
              title = '‚ö†Ô∏è Component Check Passed (with warnings)';
              summary = 'Breaking changes detected but approved.';
            }
            
            await github.rest.checks.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              name: 'Pure Component Analysis',
              head_sha: context.sha,
              status: 'completed',
              conclusion: conclusion,
              output: {
                title: title,
                summary: summary
              }
            });
```

### Phase 3: Êô∫ËÉΩÈòªÂ°ûÊ®°ÂºèÔºàÁ¨¨6-8Âë®Ôºâ

#### 3.1 Âü∫‰∫éÁªÑ‰ª∂ÈáçË¶ÅÊÄßÁöÑÂàÜÁ∫ßÁ≠ñÁï•

```yaml
# .github/pct-config.yml
notification:
  mode: "smart-blocking"
  
components:
  # Ê†∏ÂøÉÁªÑ‰ª∂ - Á†¥ÂùèÊÄßÂèòÊõ¥ÂøÖÈ°ªÂÆ°Êâπ
  critical:
    - path: "src/common/components/Button/**"
      breaking_change_policy: "block"
      required_approvers: ["@tech-lead", "@qa-lead"]
      
    - path: "src/common/components/Form/**"
      breaking_change_policy: "block"
      required_approvers: ["@frontend-team"]
      
  # ÊôÆÈÄöÁªÑ‰ª∂ - Á†¥ÂùèÊÄßÂèòÊõ¥Ë≠¶Âëä
  normal:
    - path: "src/features/**/components/**"
      breaking_change_policy: "warn"
      
  # ÂÆûÈ™åÊÄßÁªÑ‰ª∂ - ‰∏çÊ£ÄÊü•
  experimental:
    - path: "src/experimental/**"
      breaking_change_policy: "skip"
```

#### 3.2 ÈõÜÊàêCODEOWNERS

```bash
# .github/CODEOWNERS
# Pure Component Áõ∏ÂÖ≥ÂèòÊõ¥ÈúÄË¶ÅÈ¢ùÂ§ñÂÆ°Êâπ
/src/common/components/Button/ @frontend-lead @qa-lead
/src/common/components/Form/ @frontend-lead
/src/common/components/ @frontend-team
```

## 4. ÁõëÊéßÂíå‰ºòÂåñ

### 4.1 ÊÄßËÉΩÁõëÊéß

```yaml
      - name: Performance Metrics
        if: always()
        run: |
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - ${{ steps.start.outputs.time }}))
          
          # ‰∏äÊä•Âà∞ÁõëÊéßÁ≥ªÁªü
          curl -X POST $METRICS_ENDPOINT \
            -d '{
              "metric": "pct.analysis.duration",
              "value": '$DURATION',
              "tags": {
                "branch": "${{ github.head_ref }}",
                "status": "${{ job.status }}"
              }
            }'
```

### 4.2 ÂáÜÁ°ÆÁéáËøΩË∏™

```javascript
// Êî∂ÈõÜÂèçÈ¶àÊï∞ÊçÆ
const feedback = {
  component: 'Button',
  detectedAsBreaking: true,
  actuallyBreaking: false, // Áî®Êà∑ÂèçÈ¶à
  falsePositiveReason: 'Color change was intentional brand update'
};

// Áî®‰∫é‰ºòÂåñÊ£ÄÊµãÁÆóÊ≥ï
await pctApi.reportFeedback(feedback);
```

## 5. ÂºÄÂèëËÄÖ‰ΩìÈ™å‰ºòÂåñ

### 5.1 Êú¨Âú∞È¢ÑÊ£ÄÊü•

```json
// package.json
{
  "scripts": {
    "pre-push": "pct check --local",
    "pct:check": "pct analyze --base develop --format cli"
  },
  "husky": {
    "hooks": {
      "pre-push": "npm run pre-push"
    }
  }
}
```

### 5.2 IDEÈõÜÊàê

```bash
# VS Code Êâ©Â±ï
code --install-extension mdt.pure-component-analyzer

# ÂäüËÉΩÔºö
# - ÂÆûÊó∂ÊòæÁ§∫ÁªÑ‰ª∂‰ΩøÁî®ÊÉÖÂÜµ
# - ‰øÆÊîπÊó∂È¢ÑË≠¶Á†¥ÂùèÊÄßÂèòÊõ¥
# - ‰∏ÄÈîÆËøêË°åÊú¨Âú∞Ê£ÄÊü•
```

## 6. ÂõûÊªöËÆ°Âàí

Â¶ÇÊûúÈúÄË¶ÅÂø´ÈÄüÁ¶ÅÁî®PCTÊ£ÄÊü•Ôºö

### 6.1 ‰∏¥Êó∂Á¶ÅÁî®
```yaml
# Âú®PR‰∏≠Ê∑ªÂä†Ê†áÁ≠æ
labels:
  - skip-pct-check
```

### 6.2 Á¥ßÊÄ•ÂõûÊªö
```bash
# Âà†Èô§workflowÊñá‰ª∂
git rm .github/workflows/pure-component-check.yml
git commit -m "Temporarily disable PCT check"
git push
```

### 6.3 ÈÉ®ÂàÜÁ¶ÅÁî®
```yaml
# ‰øÆÊîπÈÖçÁΩÆ‰∏∫‰ªÖÈÄöÁü•Ê®°Âºè
notification:
  mode: "notify-only"  # ‰ªé "blocking" Êîπ‰∏∫ "notify-only"
```

## 7. ÊàêÂäüÊåáÊ†á

### 7.1 Áü≠ÊúüÊåáÊ†áÔºà1‰∏™ÊúàÔºâ
- CIÈõÜÊàêÂÆåÊàêÁéáÔºö100%
- Ê£ÄÊµãÂáÜÁ°ÆÁéáÔºö> 90%
- ËØØÊä•ÁéáÔºö< 10%
- CIÊó∂Èó¥Â¢ûÂä†Ôºö< 30Áßí

### 7.2 ÈïøÊúüÊåáÊ†áÔºà3‰∏™ÊúàÔºâ
- ÁªÑ‰ª∂Á†¥ÂùèÊÄßÂèòÊõ¥ÂáèÂ∞ëÔºö60%
- ÁªÑ‰ª∂Áõ∏ÂÖ≥bugÂáèÂ∞ëÔºö50%
- ÂºÄÂèëËÄÖÊª°ÊÑèÂ∫¶Ôºö> 80%
- Âπ≥Âùá‰øÆÂ§çÊó∂Èó¥ÂáèÂ∞ëÔºö40%

## 8. ÂÆûÊñΩÊó∂Èó¥Ë°®

```mermaid
gantt
    title PCT CIÈõÜÊàêÊó∂Èó¥Ë°®
    dateFormat  YYYY-MM-DD
    
    section ÂáÜÂ§áÈò∂ÊÆµ
    ÁéØÂ¢ÉÂáÜÂ§áÂíåÂü∫ÂáÜÂª∫Á´ã     :a1, 2025-02-01, 7d
    
    section Phase 1
    ÂàõÂª∫GitHub Actions     :a2, after a1, 5d
    ÂÆûÁé∞ÈÄöÁü•ÂäüËÉΩ          :a3, after a2, 5d
    ËØïËøêË°åÂíåË∞É‰ºò          :a4, after a3, 4d
    
    section Phase 2
    Ê∑ªÂä†ÈòªÂ°ûËßÑÂàô          :a5, after a4, 5d
    ÈõÜÊàêÂÆ°ÊâπÊµÅÁ®ã          :a6, after a5, 3d
    ÊñáÊ°£ÂíåÂüπËÆ≠            :a7, after a6, 2d
    
    section Phase 3
    Êô∫ËÉΩÂàÜÁ∫ßÁ≠ñÁï•          :a8, after a7, 7d
    ÊÄßËÉΩ‰ºòÂåñ              :a9, after a8, 5d
    ÂÖ®Èù¢Êé®Âπø              :a10, after a9, 10d
```

## 9. Â∏∏ËßÅÈóÆÈ¢ò

### Q: ‰∏∫‰ªÄ‰πàÈÄâÊã©GitHub ActionsËÄå‰∏çÊòØÂÖ∂‰ªñCIÔºü
A: GitHub ActionsÊèê‰æõÊúÄ‰Ω≥ÁöÑÈõ∂‰æµÂÖ•ÊÄßÈõÜÊàêÔºå‰∏çÈúÄË¶Å‰øÆÊîπÁé∞ÊúâCIÈÖçÁΩÆÔºå‰∏î‰∏éPRÊµÅÁ®ãÁ¥ßÂØÜÈõÜÊàê„ÄÇ

### Q: Â¶Ç‰ΩïÂ§ÑÁêÜËØØÊä•Ôºü
A: 
1. ‰ΩøÁî® `[pct-approved]` Ê†áËÆ∞ÊâπÂáÜ
2. Êèê‰∫§ÂèçÈ¶àÊîπËøõÁÆóÊ≥ï
3. ÈÖçÁΩÆÁªÑ‰ª∂ÁâπÂÆöËßÑÂàô

### Q: ÂØπCIÊÄßËÉΩÂΩ±ÂìçÂ¶Ç‰ΩïÔºü
A: 
- Â¢ûÈáèÂàÜÊûêÔºöÂè™Ê£ÄÊü•ÂèòÊõ¥ÁöÑÁªÑ‰ª∂
- Âπ∂Ë°åÊâßË°åÔºöÂà©Áî®GitHub ActionsÁöÑÂπ∂ÂèëËÉΩÂäõ
- Êô∫ËÉΩÁºìÂ≠òÔºöÁºìÂ≠òÂàÜÊûêÁªìÊûú
- ÁõÆÊ†áÔºö< 30ÁßíÈ¢ùÂ§ñÊó∂Èó¥

### Q: Â¶Ç‰ΩïÈÄêÊ≠•Êé®ÂπøÂà∞ÂÖ®Âõ¢ÈòüÔºü
A: 
1. ÂÖàÂú®Â∞èÂõ¢ÈòüËØïÁÇπ
2. Êî∂ÈõÜÂèçÈ¶àÂπ∂‰ºòÂåñ
3. Âà∂‰ΩúÂüπËÆ≠ÊùêÊñô
4. ÈÄê‰∏™È°πÁõÆÊé®Âπø