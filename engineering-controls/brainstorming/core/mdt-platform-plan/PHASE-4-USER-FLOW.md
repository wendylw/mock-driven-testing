# Phase 4 用户使用流程图

## 一、用户流程总览

```mermaid
graph TD
    A[开发者打开MDT平台] --> B{选择操作}
    B --> C[点击"智能分析"标签]
    C --> D[选择分析范围]
    D --> E[执行项目分析]
    E --> F[查看分析报告]
    F --> G{选择关注点}
    G --> H[查看组件风险]
    G --> I[查看API缺失]
    G --> J[查看测试建议]
    H --> K[选择高风险组件]
    I --> K
    J --> K
    K --> L[查看详细建议]
    L --> M{决策行动}
    M --> N[生成测试代码]
    M --> O[创建Mock场景]
    M --> P[导出报告]
    N --> Q[集成到项目]
    O --> R[配置场景规则]
    Q --> S[运行测试验证]
    R --> S
    S --> T[查看覆盖率提升]
```

## 二、详细用户旅程

### 🚀 启动分析（0-1分钟）

**用户故事：** 作为前端开发者，我想快速了解项目中哪些组件需要重点测试

```
1. 进入MDT平台
   └─ 看到顶部新增的"智能分析"标签（醒目提示：NEW）

2. 点击"智能分析"
   └─ 进入分析配置页面
       ├─ 默认选中：当前项目（BEEP）
       ├─ 可选范围：全部 / 特定目录 / 最近修改
       └─ 分析选项：
           ├─ [✓] 组件复用度分析
           ├─ [✓] API使用分析
           ├─ [✓] 测试覆盖分析
           └─ [ ] 深度业务流程分析（高级）

3. 点击"开始分析"
   └─ 显示进度条和实时日志
       ├─ "正在扫描组件..." (10%)
       ├─ "正在分析依赖关系..." (40%)
       ├─ "正在识别API调用..." (70%)
       └─ "正在生成报告..." (100%)
```

### 📊 查看结果（1-3分钟）

**用户故事：** 作为开发者，我想快速识别风险最高的组件并了解原因

```
4. 分析完成，自动跳转到报告页面
   └─ 看到概览仪表板
       ├─ 总体健康分数：65/100 ⚠️
       ├─ 关键指标卡片：
       │   ├─ 高风险组件：12个 🔴
       │   ├─ 缺失测试API：8个 ⚠️
       │   ├─ 测试覆盖率：60% 📊
       │   └─ 建议优先级：3个紧急
       └─ 快速操作按钮：
           ├─ [查看详情]
           ├─ [生成测试计划]
           └─ [导出报告]

5. 点击"高风险组件"卡片
   └─ 展开详细列表
       ├─ AddToCartButton ⚡ 复用12次 | 风险：高 | 测试：无
       ├─ ProductCard ⚡ 复用8次 | 风险：高 | 测试：仅单元
       └─ SearchBar ⚡ 复用6次 | 风险：中 | 测试：无
```

### 🎯 深入分析（3-5分钟）

**用户故事：** 作为开发者，我想了解为什么AddToCartButton是高风险以及如何测试它

```
6. 点击"AddToCartButton"查看详情
   └─ 进入组件分析详情页
       ├─ 风险分析：
       │   ├─ 复用度：在12个不同页面使用
       │   ├─ 复杂度：包含3种状态，4个事件处理
       │   ├─ 依赖性：调用2个关键API
       │   └─ 影响范围：影响核心购买流程
       ├─ 使用场景地图：
       │   ├─ ProductDetail (产品详情页)
       │   ├─ ProductList (产品列表)
       │   ├─ WishList (心愿单)
       │   └─ QuickView (快速预览)
       └─ 智能建议：
           ├─ 测试策略：需要4个层级的测试
           ├─ 场景列表：8个关键场景
           └─ 预估工作量：2小时完成全部测试

7. 查看"推荐的测试场景"
   └─ 智能生成的场景列表
       ├─ ✅ cart.add.success - 正常添加
       ├─ ✅ cart.add.duplicate - 重复添加
       ├─ ✅ cart.add.outofstock - 库存不足
       ├─ ✅ cart.add.unauthorized - 未登录
       ├─ ✅ cart.add.pricechange - 价格变化
       ├─ ✅ cart.add.limit - 超出限购
       ├─ ✅ cart.add.expired - 商品下架
       └─ ✅ cart.add.error - 网络错误
```

### 🔧 采取行动（5-8分钟）

**用户故事：** 作为开发者，我想快速生成测试代码并集成到项目中

```
8. 点击"生成测试代码"
   └─ 弹出生成选项
       ├─ 测试框架：[Jest + React Testing Library ▼]
       ├─ 测试类型：
       │   ├─ [✓] 组件测试
       │   ├─ [✓] 集成测试
       │   └─ [ ] E2E测试
       ├─ Mock策略：[使用MDT Mock ▼]
       └─ [确认生成]

9. 预览生成的代码
   └─ 代码预览窗口
       ├─ 标签页：
       │   ├─ AddToCartButton.test.tsx
       │   ├─ AddToCartButton.integration.test.tsx
       │   └─ cart-scenarios.json
       ├─ 代码高亮显示
       ├─ 可编辑调整
       └─ 操作按钮：
           ├─ [复制代码]
           ├─ [下载文件]
           └─ [直接创建PR]

10. 同步到项目
    └─ 选择集成方式
        ├─ 自动：创建PR到Git仓库
        ├─ 半自动：下载文件包
        └─ 手动：复制粘贴代码
```

### ✅ 验证效果（8-10分钟）

**用户故事：** 作为开发者，我想验证新增的测试是否有效提升了覆盖率

```
11. 集成测试代码后运行测试
    └─ 在MDT平台查看测试结果
        ├─ 实时测试运行状态
        ├─ 测试通过率：100% ✅
        └─ 覆盖率变化：
            ├─ 之前：60%
            ├─ 现在：75% ↑15%
            └─ 目标：85%

12. 查看改进效果
    └─ 更新后的分析报告
        ├─ AddToCartButton：高风险 → 已覆盖 ✅
        ├─ 整体健康分数：65 → 78 ↑13
        └─ 下一步建议：
            ├─ 继续处理ProductCard组件
            └─ 预计再提升10%覆盖率
```

## 三、关键交互点

### 🎨 UI交互原则

1. **渐进式披露**
   - 先展示概览，点击后展示详情
   - 避免信息过载

2. **可操作的洞察**
   - 每个分析结果都有明确的下一步操作
   - 一键生成，降低执行门槛

3. **实时反馈**
   - 分析进度可视化
   - 操作结果立即可见

4. **智能默认值**
   - 基于项目特征预设最佳配置
   - 用户可以调整但不是必须的

### 📊 数据展示策略

1. **风险可视化**
   - 红黄绿颜色编码
   - 图标强化重要性

2. **对比展示**
   - 前后对比突出改进效果
   - 目标差距激励持续改进

3. **上下文信息**
   - 解释为什么是高风险
   - 提供具体的改进建议

## 四、第一周MVP聚焦

基于这个完整流程，第一周MVP应该聚焦实现：

### ✅ 核心功能（必须有）
1. **基础分析能力**
   - 扫描项目识别React组件
   - 计算组件复用度
   - 生成风险评分

2. **简单报告页面**
   - 展示高风险组件列表
   - 显示基本的使用统计
   - 提供简单的测试建议

### ⏸️ 延后功能（第二周）
- 测试代码自动生成
- Mock场景智能推荐
- 深度API分析

### 🎯 成功指标
1. **技术指标**：30秒内完成45个组件的分析
2. **业务指标**：准确识别出AddToCartButton等高风险组件

这个流程设计是否符合您的期望？需要调整哪些部分？